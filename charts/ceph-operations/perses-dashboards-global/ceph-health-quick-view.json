{
  "kind": "Dashboard",
  "metadata": {
    "name": "ceph-health-quick-view",
    "project": "ceph-global"
  },
  "spec": {
    "display": {
      "name": "ceph health quick view"
    },
    "panels": {
      "0": {
        "kind": "Panel",
        "spec": {
          "display": {
            "name": "Ceph Health"
          },
          "plugin": {
            "kind": "Table",
            "spec": {
              "cellSettings": [
                {
                  "condition": {
                    "kind": "Misc",
                    "spec": {
                      "value": "null"
                    }
                  },
                  "text": "0"
                }
              ],
              "columnSettings": [
                {
                  "enableSorting": true,
                  "header": "Region",
                  "hide": false,
                  "name": "region",
                  "sort": "asc"
                },
                {
                  "header": "Health Status",
                  "name": "value #1"
                },
                {
                  "header": "Ceph Alerts",
                  "name": "value #2"
                },
                {
                  "format": {
                    "unit": "bytes/sec"
                  },
                  "header": "Write Throughput",
                  "name": "value #3"
                },
                {
                  "format": {
                    "unit": "bytes/sec"
                  },
                  "header": "Read Throughput",
                  "name": "value #4"
                },
                {
                  "format": {
                    "unit": "ops/sec"
                  },
                  "header": "Write IOPs",
                  "name": "value #5"
                },
                {
                  "format": {
                    "unit": "ops/sec"
                  },
                  "header": "Read IOPs",
                  "name": "value #6"
                },
                {
                  "header": "OSDs OUT",
                  "name": "value #7"
                },
                {
                  "header": "OSDs DOWN",
                  "name": "value #8"
                },
                {
                  "header": "OSDs UP",
                  "name": "value #9"
                },
                {
                  "header": "OSDs IN",
                  "name": "value #10"
                },
                {
                  "hide": true,
                  "name": "timestamp"
                },
                {
                  "hide": true,
                  "name": "__name__"
                },
                {
                  "hide": true,
                  "name": "cluster"
                },
                {
                  "hide": true,
                  "name": "cluster_type"
                },
                {
                  "hide": true,
                  "name": "container"
                },
                {
                  "hide": true,
                  "name": "endpoint"
                },
                {
                  "hide": true,
                  "name": "instance"
                },
                {
                  "hide": true,
                  "name": "job"
                },
                {
                  "hide": true,
                  "name": "namespace"
                },
                {
                  "hide": true,
                  "name": "organization"
                },
                {
                  "hide": true,
                  "name": "pod"
                },
                {
                  "hide": true,
                  "name": "prometheus"
                },
                {
                  "hide": true,
                  "name": "service"
                }
              ],
              "density": "standard",
              "transforms": [
                {
                  "kind": "MergeSeries",
                  "spec": {}
                },
                {
                  "kind": "JoinByColumnValue",
                  "spec": {
                    "columns": [
                      "region"
                    ]
                  }
                }
              ]
            }
          },
          "queries": [
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "minStep": "",
                    "query": "ceph_health_status",
                    "seriesNameFormat": ""
                  }
                }
              }
            },
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "minStep": "",
                    "query": "count(ALERTS{alertstate=\"firing\", alertname=~\"^Ceph.+\"}) by (region)",
                    "seriesNameFormat": ""
                  }
                }
              }
            },
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "minStep": "",
                    "query": "sum(irate(ceph_osd_op_w_in_bytes[$__rate_interval])) by (region)",
                    "seriesNameFormat": ""
                  }
                }
              }
            },
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "minStep": "",
                    "query": "sum(irate(ceph_osd_op_r_out_bytes[$__rate_interval])) by (region)",
                    "seriesNameFormat": ""
                  }
                }
              }
            },
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "minStep": "",
                    "query": "sum(irate(ceph_osd_op_w[$__rate_interval])) by (region)",
                    "seriesNameFormat": ""
                  }
                }
              }
            },
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "minStep": "",
                    "query": "sum(irate(ceph_osd_op_r[$__rate_interval])) by (region)",
                    "seriesNameFormat": ""
                  }
                }
              }
            },
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "minStep": "",
                    "query": "sum(ceph_osd_in == bool 0) by (region)",
                    "seriesNameFormat": ""
                  }
                }
              }
            },
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "minStep": "",
                    "query": "sum(ceph_osd_up == bool 0) by (region)",
                    "seriesNameFormat": ""
                  }
                }
              }
            },
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "minStep": "",
                    "query": "sum(ceph_osd_up) by (region)",
                    "seriesNameFormat": ""
                  }
                }
              }
            },
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "minStep": "",
                    "query": "sum(ceph_osd_in) by (region)",
                    "seriesNameFormat": ""
                  }
                }
              }
            }
          ]
        }
      },
      "879f4d7930f54835a4d0202d2681492b": {
        "kind": "Panel",
        "spec": {
          "display": {
            "name": "Ceph Health Details",
            "description": "Will contain Ceph warnings or errors even though an alert as not been firing (yet)."
          },
          "plugin": {
            "kind": "Table",
            "spec": {
              "columnSettings": [
                {
                  "enableSorting": true,
                  "header": "Region",
                  "name": "region",
                  "sort": "asc",
                  "width": 50
                },
                {
                  "header": "Name",
                  "name": "name"
                },
                {
                  "header": "Instance",
                  "hide": true,
                  "name": "instance",
                  "width": 100
                },
                {
                  "header": "Pod",
                  "hide": true,
                  "name": "pod"
                },
                {
                  "header": "Severity",
                  "hide": true,
                  "name": "severity",
                  "width": "auto"
                },
                {
                  "hide": true,
                  "name": "__name__"
                },
                {
                  "hide": true,
                  "name": "cluster"
                },
                {
                  "hide": true,
                  "name": "cluster_type"
                },
                {
                  "hide": true,
                  "name": "container"
                },
                {
                  "hide": true,
                  "name": "endpoint"
                },
                {
                  "hide": true,
                  "name": "job"
                },
                {
                  "hide": true,
                  "name": "namespace"
                },
                {
                  "hide": true,
                  "name": "prometheus"
                },
                {
                  "hide": true,
                  "name": "service"
                },
                {
                  "hide": true,
                  "name": "timestamp"
                },
                {
                  "hide": true,
                  "name": "value"
                }
              ],
              "density": "standard",
              "pagination": true
            }
          },
          "queries": [
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "query": "ceph_health_detail{region=~\"$region\"} > 0"
                  }
                }
              }
            }
          ]
        }
      },
      "CephAlerts": {
        "kind": "Panel",
        "spec": {
          "display": {
            "name": "Ceph Alerts"
          },
          "plugin": {
            "kind": "Table",
            "spec": {
              "columnSettings": [
                {
                  "enableSorting": true,
                  "header": "Region",
                  "name": "region",
                  "sort": "asc",
                  "width": 50
                },
                {
                  "header": "Alert Name",
                  "name": "alertname",
                  "width": 80
                },
                {
                  "header": "Name",
                  "name": "name"
                },
                {
                  "hide": true,
                  "name": "node"
                },
                {
                  "hide": true,
                  "name": "device"
                },
                {
                  "hide": true,
                  "name": "fstype"
                },
                {
                  "hide": true,
                  "name": "mountpoint"
                },
                {
                  "hide": true,
                  "name": "nodename"
                },
                {
                  "hide": true,
                  "name": "pod"
                },
                {
                  "hide": true,
                  "name": "__name__"
                },
                {
                  "hide": true,
                  "name": "alertstate"
                },
                {
                  "hide": true,
                  "name": "cluster"
                },
                {
                  "hide": true,
                  "name": "cluster_type"
                },
                {
                  "hide": true,
                  "name": "container"
                },
                {
                  "hide": true,
                  "name": "endpoint"
                },
                {
                  "hide": true,
                  "name": "inhibited_by"
                },
                {
                  "hide": true,
                  "name": "instance"
                },
                {
                  "hide": true,
                  "name": "job"
                },
                {
                  "hide": true,
                  "name": "namespace"
                },
                {
                  "hide": true,
                  "name": "prometheus"
                },
                {
                  "hide": true,
                  "name": "service"
                },
                {
                  "hide": true,
                  "name": "severity"
                },
                {
                  "hide": true,
                  "name": "support_group"
                },
                {
                  "hide": true,
                  "name": "timestamp"
                },
                {
                  "hide": true,
                  "name": "type"
                },
                {
                  "hide": true,
                  "name": "value"
                },
                {
                  "hide": true,
                  "name": "oid"
                }
              ],
              "density": "standard",
              "pagination": true
            }
          },
          "queries": [
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "query": "ALERTS{alertstate=\"firing\", alertname=~\"^Ceph.+\", region=~\"$region\"}"
                  }
                }
              }
            }
          ]
        }
      }
    },
    "layouts": [
      {
        "kind": "Grid",
        "spec": {
          "display": {
            "title": "",
            "collapse": {
              "open": true
            }
          },
          "items": [
            {
              "x": 0,
              "y": 14,
              "width": 12,
              "height": 11,
              "content": {
                "$ref": "#/spec/panels/CephAlerts"
              }
            },
            {
              "x": 0,
              "y": 0,
              "width": 24,
              "height": 14,
              "content": {
                "$ref": "#/spec/panels/0"
              }
            },
            {
              "x": 12,
              "y": 14,
              "width": 12,
              "height": 11,
              "content": {
                "$ref": "#/spec/panels/879f4d7930f54835a4d0202d2681492b"
              }
            }
          ]
        }
      }
    ],
    "variables": [
      {
        "kind": "ListVariable",
        "spec": {
          "display": {
            "name": "Region",
            "hidden": false
          },
          "defaultValue": "$__all",
          "allowAllValue": true,
          "allowMultiple": true,
          "plugin": {
            "kind": "PrometheusLabelValuesVariable",
            "spec": {
              "labelName": "region"
            }
          },
          "name": "region"
        }
      }
    ],
    "duration": "1h",
    "refreshInterval": "0s"
  }
}