{
  "kind": "Dashboard",
  "metadata": {
    "name": "ceph-capacity-quick-view",
    "project": "ceph-global"
  },
  "spec": {
    "display": {
      "name": "ceph capacity quick view"
    },
    "panels": {
      "0": {
        "kind": "Panel",
        "spec": {
          "display": {
            "name": "Ceph Capacity"
          },
          "plugin": {
            "kind": "Table",
            "spec": {
              "columnSettings": [
                {
                  "header": "Region",
                  "hide": false,
                  "name": "region"
                },
                {
                  "format": {
                    "unit": "bytes"
                  },
                  "header": "Cluster Capacity",
                  "name": "value #1"
                },
                {
                  "format": {
                    "unit": "bytes"
                  },
                  "header": "Resource Usage",
                  "name": "value #2"
                },
                {
                  "format": {
                    "unit": "percent-decimal"
                  },
                  "header": "Resource Usage (%)",
                  "hide": false,
                  "name": "value #3"
                },
                {
                  "hide": true,
                  "name": "timestamp"
                },
                {
                  "hide": true,
                  "name": "__name__"
                },
                {
                  "hide": true,
                  "name": "cluster"
                },
                {
                  "hide": true,
                  "name": "cluster_type"
                },
                {
                  "hide": true,
                  "name": "container"
                },
                {
                  "hide": true,
                  "name": "endpoint"
                },
                {
                  "hide": true,
                  "name": "instance"
                },
                {
                  "hide": true,
                  "name": "job"
                },
                {
                  "hide": true,
                  "name": "namespace"
                },
                {
                  "hide": true,
                  "name": "organization"
                },
                {
                  "hide": true,
                  "name": "pod"
                },
                {
                  "hide": true,
                  "name": "prometheus"
                },
                {
                  "name": "service",
                  "hide": true
                }
              ],
              "density": "compact",
              "transforms": [
                {
                  "kind": "MergeSeries",
                  "spec": {}
                },
                {
                  "kind": "JoinByColumnValue",
                  "spec": {
                    "columns": [
                      "region"
                    ]
                  }
                }
              ]
            }
          },
          "queries": [
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "datasource": {
                      "kind": "PrometheusDatasource",
                      "name": "thanos-global-st1-eu-de-1-query"
                    },
                    "minStep": "",
                    "query": "ceph_cluster_total_bytes",
                    "seriesNameFormat": ""
                  }
                }
              }
            },
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "datasource": {
                      "kind": "PrometheusDatasource",
                      "name": "thanos-global-st1-eu-de-1-query"
                    },
                    "minStep": "",
                    "query": "ceph_cluster_total_used_bytes",
                    "seriesNameFormat": ""
                  }
                }
              }
            },
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "datasource": {
                      "kind": "PrometheusDatasource",
                      "name": "thanos-global-st1-eu-de-1-query"
                    },
                    "minStep": "",
                    "query": "1 - (ceph_cluster_total_bytes - ceph_cluster_total_used_bytes) / ceph_cluster_total_bytes",
                    "seriesNameFormat": ""
                  }
                }
              }
            }
          ]
        }
      },
      "1": {
        "kind": "Panel",
        "spec": {
          "display": {
            "name": "Ceph Quota"
          },
          "plugin": {
            "kind": "Table",
            "spec": {
              "columnSettings": [
                {
                  "header": "Region",
                  "name": "region",
                  "hide": false
                },
                {
                  "header": "Capacity",
                  "name": "value #1",
                  "format": {
                    "unit": "bytes"
                  }
                },
                {
                  "header": "Quota Usage",
                  "name": "value #2",
                  "format": {
                    "unit": "bytes"
                  }
                },
                {
                  "header": "Unassigned Quota",
                  "name": "value #3",
                  "format": {
                    "unit": "bytes"
                  }
                },
                {
                  "header": "Resource Usage",
                  "name": "value #4",
                  "format": {
                    "unit": "bytes"
                  }
                },
                {
                  "header": "Quota Usage %",
                  "name": "value #5",
                  "align": "left",
                  "format": {
                    "unit": "percent-decimal"
                  }
                },
                {
                  "header": "Resource Usage %",
                  "name": "value #6",
                  "format": {
                    "unit": "percent-decimal"
                  }
                },
                {
                  "name": "timestamp",
                  "hide": true
                }
              ],
              "density": "compact",
              "transforms": [
                {
                  "kind": "MergeSeries",
                  "spec": {}
                }
              ]
            }
          },
          "queries": [
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "datasource": {
                      "kind": "PrometheusDatasource"
                    },
                    "minStep": "",
                    "query": "max(global:limes_consolidated_cluster_capacity{full_resource=~\"ceph/(.*)\"}) by (region) *\nmax(global:limes_consolidated_unit_multiplier{full_resource=~\"ceph/(.*)\"}) by (region)",
                    "seriesNameFormat": ""
                  }
                }
              }
            },
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "datasource": {
                      "kind": "PrometheusDatasource"
                    },
                    "minStep": "",
                    "query": "sum(global:limes_consolidated_domain_quota{full_resource=~\"ceph/(.*)\"}) by (region) *\nmax(global:limes_consolidated_unit_multiplier{full_resource=~\"ceph/(.*)\"}) by (region)",
                    "seriesNameFormat": ""
                  }
                }
              }
            },
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "datasource": {
                      "kind": "PrometheusDatasource"
                    },
                    "minStep": "",
                    "query": "(\n  max(global:limes_consolidated_cluster_capacity{full_resource=~\"ceph/(.*)\"}) by (region) *\n  max(global:limes_consolidated_unit_multiplier{full_resource=~\"ceph/(.*)\"}) by (region)\n) - (\n  sum(global:limes_consolidated_domain_quota{full_resource=~\"ceph/(.*)\"}) by (region) *\n  max(global:limes_consolidated_unit_multiplier{full_resource=~\"ceph/(.*)\"}) by (region)\n)",
                    "seriesNameFormat": ""
                  }
                }
              }
            },
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "datasource": {
                      "kind": "PrometheusDatasource"
                    },
                    "minStep": "",
                    "query": "sum(global:limes_consolidated_domain_usage{full_resource=~\"ceph/(.*)\"}) by (region) *\nmax(global:limes_consolidated_unit_multiplier{full_resource=~\"ceph/(.*)\"}) by (region)",
                    "seriesNameFormat": ""
                  }
                }
              }
            },
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "datasource": {
                      "kind": "PrometheusDatasource"
                    },
                    "minStep": "",
                    "query": "(\n  sum(global:limes_consolidated_domain_quota{full_resource=~\"ceph/(.*)\"}) by (region) *\n  max(global:limes_consolidated_unit_multiplier{full_resource=~\"ceph/(.*)\"}) by (region)\n) / (\n  max(global:limes_consolidated_cluster_capacity{full_resource=~\"ceph/(.*)\"}) by (region) *\n  max(global:limes_consolidated_unit_multiplier{full_resource=~\"ceph/(.*)\"}) by (region)\n)",
                    "seriesNameFormat": ""
                  }
                }
              }
            },
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "datasource": {
                      "kind": "PrometheusDatasource"
                    },
                    "minStep": "",
                    "query": "(\n  sum(global:limes_consolidated_domain_usage{full_resource=~\"ceph/(.*)\"}) by (region) *\n  max(global:limes_consolidated_unit_multiplier{full_resource=~\"ceph/(.*)\"}) by (region)\n) / (\n  max(global:limes_consolidated_cluster_capacity{full_resource=~\"ceph/(.*)\"}) by (region) *\n  max(global:limes_consolidated_unit_multiplier{full_resource=~\"ceph/(.*)\"}) by (region)\n)",
                    "seriesNameFormat": ""
                  }
                }
              }
            }
          ]
        }
      }
    },
    "layouts": [
      {
        "kind": "Grid",
        "spec": {
          "items": [
            {
              "x": 0,
              "y": 0,
              "width": 9,
              "height": 14,
              "content": {
                "$ref": "#/spec/panels/0"
              }
            },
            {
              "x": 9,
              "y": 0,
              "width": 15,
              "height": 14,
              "content": {
                "$ref": "#/spec/panels/1"
              }
            }
          ]
        }
      }
    ],
    "variables": [],
    "duration": "1h",
    "refreshInterval": "0s"
  }
}